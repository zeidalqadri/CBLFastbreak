<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Coaching Program - Pre-Program Survey</title>
    <style>
        /* Paste your original CSS here */
    </style>
</head>
<body>
    <div class="container">
        <!-- Paste your original HTML form here -->
    </div>
    <script>
        // --- Google Sheets Integration ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxXHr46BCZ0SyxDlVco2B-wIstQvK_p56EF9LZUolPYHp10u0-eIN4y_ZKSPrNQnk8/exec'; // e.g. https://script.google.com/macros/s/...

        // Progress tracking (unchanged)
        const sections = document.querySelectorAll('.section');
        const progressFill = document.getElementById('progressFill');
        const form = document.getElementById('basketballSurvey');

        function updateProgress() {
            const totalSections = sections.length;
            let completedSections = 0;

            sections.forEach(section => {
                const requiredInputs = section.querySelectorAll('input[required], textarea[required]');
                const allRequiredFilled = Array.from(requiredInputs).every(input => {
                    if (input.type === 'radio') {
                        return section.querySelector(`input[name="${input.name}"]:checked`);
                    }
                    return input.value.trim() !== '';
                });

                if (allRequiredFilled) {
                    completedSections++;
                }
            });

            const progress = (completedSections / totalSections) * 100;
            progressFill.style.width = progress + '%';
        }

        // Add event listeners to all form inputs
        form.addEventListener('input', updateProgress);
        form.addEventListener('change', updateProgress);

        // --- Serialize form data robustly ---
        function getFormData(form) {
            const data = {};
            const formData = new FormData(form);

            // For checkboxes with same name, collect all checked values as array
            form.querySelectorAll('input[type="checkbox"]').forEach(input => {
                if (!data[input.name]) data[input.name] = [];
            });

            for (const [key, value] of formData.entries()) {
                const input = form.querySelector(`[name="${key}"]`);
                if (input && input.type === 'checkbox') {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else if (input && input.type === 'radio') {
                    data[key] = value;
                } else {
                    data[key] = value;
                }
            }

            // Remove empty arrays (unchecked checkboxes)
            Object.keys(data).forEach(key => {
                if (Array.isArray(data[key]) && data[key].length === 0) {
                    delete data[key];
                }
            });

            return data;
        }

        // --- Form submission with Google Sheets integration ---
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const data = getFormData(form);

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.result === 'success') {
                    alert('Thank you! Your survey has been submitted successfully. We\'ll contact you within one week.');
                    submitBtn.textContent = 'Submitted âœ“';
                    localStorage.removeItem('basketballSurveyData');
                    form.reset();
                    updateProgress();
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            })
            .catch(err => {
                alert('Sorry, there was a problem submitting your survey. Please try again.\n\n' + err.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Survey';
            });
        });

        // --- Auto-save functionality (unchanged) ---
        let autoSaveTimeout;
        form.addEventListener('input', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                const data = getFormData(form);
                localStorage.setItem('basketballSurveyData', JSON.stringify(data));
            }, 2000);
        });

        // --- Load saved data on page load (unchanged) ---
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('basketballSurveyData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(key => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) {
                            if (input.type === 'radio' || input.type === 'checkbox') {
                                if (Array.isArray(data[key])) {
                                    data[key].forEach(val => {
                                        const specificInput = form.querySelector(`[name="${key}"][value="${val}"]`);
                                        if (specificInput) specificInput.checked = true;
                                    });
                                } else {
                                    const specificInput = form.querySelector(`[name="${key}"][value="${data[key]}"]`);
                                    if (specificInput) specificInput.checked = true;
                                }
                            } else {
                                input.value = data[key];
                            }
                        }
                    });
                    updateProgress();
                } catch (e) {
                    console.log('Error loading saved data');
                }
            }
        });
    </script>
</body>
</html>
